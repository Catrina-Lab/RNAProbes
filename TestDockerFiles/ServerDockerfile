FROM python:3.9-slim


WORKDIR /app

COPY pyproject.toml poetry.lock ./
RUN pip install poetry \
    && poetry config virtualenvs.in-project true \
    && poetry install --all-extras

COPY . .

ENV IS_WEB_APP=TRUE
RUN find /app/src/rnaprobes/RNAStructure_Binaries/Linux64 -type f -exec chmod +x {} +

RUN find src/rnaprobes/RNAStructure_Binaries/Linux64 -type f -exec chmod +x {} \;
CMD [".venv/bin/python3", "-m", "gunicorn", "-w", "4", "app:app", "-b", "0.0.0.0:8080"]